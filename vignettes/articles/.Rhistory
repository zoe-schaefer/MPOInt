# filter by that list
total_histone_int <- filter(histone_single_p, grepl(targets, PTM))
total_histone_int$Diff <- case_when(total_histone_int$`log2(FC)` > 0 ~ "Up",
total_histone_int$`log2(FC)` < 0 ~ "Down")
# Making sure that no histone data has gotten lost in processing -
# this should match the figure from the earlier section
ggplot(total_histone_int, aes(x = `log2(FC)`, y = -log10(`P value`))) +
geom_point() +
geom_vline(xintercept = c(total_FC_threshold, -total_FC_threshold),
alpha = 0.5, linetype = "dashed") +
geom_hline(yintercept = -log10(total_p_threshold),
alpha = 0.5, linetype = "dashed") +
labs(x = "log2(Fold Change)", y = "-log10(P value)",
title = "Figure 7b: Volcano plot") +
geom_text_repel(aes(label = PTM), show.legend = FALSE, size = rel(3)) +
theme(legend.position = "bottom")
# Pivoting and formatting the gene list
genes_pivoted <- dplyr::select(genes, c("HGNC approved symbol", "Protein complex", "Target entity", "Product")) %>% dplyr::rename("Symbol" = "HGNC approved symbol", "Complex" = "Protein complex", "Target" = "Target entity", "Product" = "Product")
genes_pivoted <- genes_pivoted %>%
separate_wider_delim(cols = c("Complex", "Target", "Product"), delim = ", ",
names_sep = "_", too_few = "align_start")
genes_pivoted <- genes_pivoted %>%
pivot_longer(cols = dplyr::starts_with("Complex"), names_to = NULL,
values_to = "Complex", values_drop_na = TRUE) %>%
pivot_longer(cols = dplyr::starts_with("Target"), names_to = NULL,
values_to = "Target", values_drop_na = TRUE) %>%
pivot_longer(cols = dplyr::starts_with("Product"), names_to = NULL,
values_to = "Product", values_drop_na = TRUE)
genes_data_joined <- inner_join(genes_pivoted,
dplyr::select(joined_data, c("HGNC approved symbol",
"log2(FC)", "P value", "Source")),
by = join_by("Symbol" == "HGNC approved symbol"),
relationship = "many-to-many")
genes_histone_joined <- left_join(genes_histone_pivoted,
dplyr::select(total_histone_int, c("PTM",
"log2(FC)", "P value", "Diff")),
by = c("PTM" = "PTM"), suffix = c("_gene", "_hist"),
relationship = "many-to-many"
)
genes_histone_joined <- relocate(genes_histone_joined, Complex, .after = PTM)
genes_histone_joined[genes_histone_joined == "#"] <- "No ID"
complexes <- unique(genes_histone_joined$Complex)
n_complexes <- seq(1, length(complexes))
color_opts <- c("#FFFFFF", qualpalr::qualpal(n = (length(complexes) - 1), colorspace = "rainbow")$hex)
complex_df <- data.frame(complexes, n_complexes, color = color_opts)
complex_vertices <- data.frame(vertices = c(unique(genes_histone_joined$Symbol), unique(genes_histone_joined$PTM)))
genes_histone_joined <- full_join(genes_histone_joined, complex_df, by = join_by("Complex" == "complexes")) %>% relocate(c("Symbol", "PTM"))
complex_vertices <- full_join(complex_vertices, genes_histone_joined, by = join_by("vertices" == "Symbol"), multiple = "all") %>%
dplyr::select(c("vertices", "Complex", "Source", "Diff_gene")) %>% distinct(vertices, .keep_all = TRUE)
complex_graph <- graph_from_data_frame(d = genes_histone_joined, vertices = complex_vertices, directed = FALSE)
with_id <- filter(genes_histone_joined, Complex != "No ID") %>% drop_na("P value_gene")
sig_network <- distinct(group_by(filter(genes_histone_joined, Complex != "No ID"), Complex), Symbol, .keep_all = TRUE)
sig_network["weight"] <- 1
sig_network$Complex <- factor(sig_network$Complex, levels = unique(as.character(sig_network$Complex)))
ggplot(sig_network, aes(x = Complex, y = weight)) +
geom_col(aes(fill = Complex), position = "stack", width = 0.7) +
geom_label(aes(label = Symbol, angle = 30), size = rel(2),
position = position_stack(vjust = 0.5)) +
guides(fill = "none") +
theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
axis.title.x = element_blank(), axis.title.y = element_blank(),
plot.margin = margin(t = 10, r = 10, b = 10, l = 10)) +
labs(title = "Figure 7c: Network components")
leg <- ggpubr::get_legend(ggplot(sig_network, aes(x = Complex, y = weight)) +
geom_col(aes(fill = Complex), position = "stack") +
scale_fill_manual(values = unique(sig_network$color)) +
guides(fill = guide_legend(ncol = 4)))
ggpubr::as_ggplot(leg)
ggplot(sig_network, aes(x = Complex, y = Symbol, fill = PTM)) +
geom_bin_2d() +
theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
axis.title.x = element_blank(), axis.title.y = element_blank()) +
paletteer::scale_fill_paletteer_d("ggsci::default_igv") +
scale_y_discrete(limits = rev) +
labs(title = "Figure 7d: Network bins")
sig_network$Shapes<- case_when(sig_network$Diff_gene == "Up" ~ "triangle",
sig_network$Diff_gene == "Down" ~ "triangleDown")
sig_network_py <- r_to_py(sig_network)
reticulate::repl_python()
htmltools::renderDocument(htmltools::htmlTemplate("networkx-pyvis.html"))
genes_histone_joined <- right_join(genes_histone_pivoted,
dplyr::select(total_histone_int, c("PTM",
"log2(FC)", "P value", "Diff")),
by = c("PTM" = "PTM"), suffix = c("_gene", "_hist"),
relationship = "many-to-many"
)
genes_histone_joined <- right_join(genes_histone_pivoted,
dplyr::select(total_histone_int, c("PTM",
"log2(FC)", "P value", "Diff")),
by = c("PTM" = "PTM"), suffix = c("_gene", "_hist"),
relationship = "many-to-many"
)
genes_histone_joined <- relocate(genes_histone_joined, Complex, .after = PTM)
genes_histone_joined[genes_histone_joined == "#"] <- "No ID"
complexes <- unique(genes_histone_joined$Complex)
n_complexes <- seq(1, length(complexes))
color_opts <- c("#FFFFFF", qualpalr::qualpal(n = (length(complexes) - 1), colorspace = "rainbow")$hex)
complex_df <- data.frame(complexes, n_complexes, color = color_opts)
complex_vertices <- data.frame(vertices = c(unique(genes_histone_joined$Symbol), unique(genes_histone_joined$PTM)))
genes_histone_joined <- full_join(genes_histone_joined, complex_df, by = join_by("Complex" == "complexes")) %>% relocate(c("Symbol", "PTM"))
complex_vertices <- full_join(complex_vertices, genes_histone_joined, by = join_by("vertices" == "Symbol"), multiple = "all") %>%
dplyr::select(c("vertices", "Complex", "Source", "Diff_gene")) %>% distinct(vertices, .keep_all = TRUE)
complex_graph <- graph_from_data_frame(d = genes_histone_joined, vertices = complex_vertices, directed = FALSE)
with_id <- filter(genes_histone_joined, Complex != "No ID") %>% drop_na("P value_gene")
sig_network <- distinct(group_by(filter(genes_histone_joined, Complex != "No ID"), Complex), Symbol, .keep_all = TRUE)
sig_network["weight"] <- 1
sig_network$Complex <- factor(sig_network$Complex, levels = unique(as.character(sig_network$Complex)))
ggplot(sig_network, aes(x = Complex, y = weight)) +
geom_col(aes(fill = Complex), position = "stack", width = 0.7) +
geom_label(aes(label = Symbol, angle = 30), size = rel(2),
position = position_stack(vjust = 0.5)) +
guides(fill = "none") +
theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
axis.title.x = element_blank(), axis.title.y = element_blank(),
plot.margin = margin(t = 10, r = 10, b = 10, l = 10)) +
labs(title = "Figure 7c: Network components")
ggplot(sig_network, aes(x = Complex, y = Symbol, fill = PTM)) +
geom_bin_2d() +
theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
axis.title.x = element_blank(), axis.title.y = element_blank()) +
paletteer::scale_fill_paletteer_d("ggsci::default_igv") +
scale_y_discrete(limits = rev) +
labs(title = "Figure 7d: Network bins")
sig_network$Shapes<- case_when(sig_network$Diff_gene == "Up" ~ "triangle",
sig_network$Diff_gene == "Down" ~ "triangleDown")
sig_network_py <- r_to_py(sig_network)
reticulate::repl_python()
htmltools::renderDocument(htmltools::htmlTemplate("networkx-pyvis.html"))
View(complex_vertices)
new_vertices <- pivot_longer(genes_histone_joined, cols = c("Diff_gene", "Diff_hist"), names_to = NULL, values_to = "Diff")
View(new_vertices)
complexes <- unique(new_vertices$Complex)
n_complexes <- seq(1, length(complexes))
color_opts <- c("#FFFFFF", qualpalr::qualpal(n = (length(complexes) - 1), colorspace = "rainbow")$hex)
complex_df <- data.frame(complexes, n_complexes, color = color_opts)
complex_vertices <- data.frame(vertices = c(unique(new_vertices$Symbol), unique(new_vertices$PTM)))
genes_histone_joined <- full_join(new_vertices, complex_df, by = join_by("Complex" == "complexes")) %>% relocate(c("Symbol", "PTM"))
complex_vertices <- full_join(complex_vertices, new_vertices, by = join_by("vertices" == "Symbol"), multiple = "all") %>%
dplyr::select(c("vertices", "Complex", "Source", "Diff")) %>% distinct(vertices, .keep_all = TRUE)
complex_graph <- graph_from_data_frame(d = genes_histone_joined, vertices = complex_vertices, directed = FALSE)
complex_graph <- graph_from_data_frame(d = new_vertices, vertices = complex_vertices, directed = FALSE)
new_vertices <- pivot_longer(genes_histone_joined, cols = c("Diff_gene", "Diff_hist"), names_to = NULL, values_to = "Diff")
genes_histone_joined <- right_join(genes_histone_pivoted,
dplyr::select(total_histone_int, c("PTM",
"log2(FC)", "P value", "Diff")),
by = c("PTM" = "PTM"), suffix = c("_gene", "_hist"),
relationship = "many-to-many"
)
genes_histone_joined <- relocate(genes_histone_joined, Complex, .after = PTM)
genes_histone_joined[genes_histone_joined == "#"] <- "No ID"
new_vertices <- pivot_longer(genes_histone_joined, cols = c("Diff_gene", "Diff_hist"), names_to = NULL, values_to = "Diff")
new_vertices <- pivot_longer(genes_histone_joined, cols = c("Diff_gene", "Diff_hist"), names_to = NULL, values_to = "Diff") %>% pivot_longer(cols = c("Symbol", "PTM"), names_to = NULL, values_to = "Name")
new_vertices <- pivot_longer(genes_histone_joined, cols = c("Diff_gene", "Diff_hist"), names_to = NULL, values_to = "Diff") %>% pivot_longer(cols = c("Symbol", "PTM"), names_to = NULL, values_to = "Name") %>% relocate(c("Name")) %>% distinct()
new_vertices <- pivot_longer(genes_histone_joined, cols = c("Diff_gene", "Diff_hist"), names_to = NULL, values_to = "Diff")
View(complex_df)
View(genes_data_joined)
View(genes_histone_joined)
genes_histone_joined[genes_histone_joined == ("#" | NA)] <- "No ID"
genes_histone_joined$Complex <- replace_na(genes_histone_joined$Complex, "No ID")
complexes <- unique(genes_histone_joined$Complex)
n_complexes <- seq(1, length(complexes))
color_opts <- c("#FFFFFF", qualpalr::qualpal(n = (length(complexes) - 1), colorspace = "rainbow")$hex)
complex_df <- data.frame(complexes, n_complexes, color = color_opts)
complex_vertices <- data.frame(vertices = c(unique(genes_histone_joined$Symbol), unique(genes_histone_joined$PTM)))
genes_histone_joined <- full_join(genes_histone_joined, complex_df, by = join_by("Complex" == "complexes")) %>% relocate(c("Symbol", "PTM"))
complex_vertices <- full_join(complex_vertices, genes_histone_joined, by = join_by("vertices" == "Symbol"), multiple = "all") %>%
dplyr::select(c("vertices", "Complex", "Source", "Diff_gene")) %>% distinct(vertices, .keep_all = TRUE)
complex_graph <- graph_from_data_frame(d = genes_histone_joined, vertices = complex_vertices, directed = FALSE)
genes_histone_joined$Complex <- genes_histone_joined$Complex %>%  replace_na("No ID")
complexes <- unique(genes_histone_joined$Complex)
n_complexes <- seq(1, length(complexes))
color_opts <- c("#FFFFFF", qualpalr::qualpal(n = (length(complexes) - 1), colorspace = "rainbow")$hex)
complex_df <- data.frame(complexes, n_complexes, color = color_opts)
complex_vertices <- data.frame(vertices = c(unique(genes_histone_joined$Symbol), unique(genes_histone_joined$PTM)))
genes_histone_joined <- full_join(genes_histone_joined, complex_df, by = join_by("Complex" == "complexes")) %>% relocate(c("Symbol", "PTM"))
complex_vertices <- full_join(complex_vertices, genes_histone_joined, by = join_by("vertices" == "Symbol"), multiple = "all") %>%
dplyr::select(c("vertices", "Complex", "Source", "Diff_gene")) %>% distinct(vertices, .keep_all = TRUE)
complex_graph <- graph_from_data_frame(d = genes_histone_joined, vertices = complex_vertices, directed = FALSE)
network_df <- full_join(genes_histone_joined, complex_df, by = join_by("Complex" == "complexes")) %>% relocate(c("Symbol", "PTM"))
# Pivoting and formatting the gene list
genes_pivoted <- dplyr::select(genes, c("HGNC approved symbol", "Protein complex", "Target entity", "Product")) %>% dplyr::rename("Symbol" = "HGNC approved symbol", "Complex" = "Protein complex", "Target" = "Target entity", "Product" = "Product")
genes_pivoted <- genes_pivoted %>%
separate_wider_delim(cols = c("Complex", "Target", "Product"), delim = ", ",
names_sep = "_", too_few = "align_start")
genes_pivoted <- genes_pivoted %>%
pivot_longer(cols = dplyr::starts_with("Complex"), names_to = NULL,
values_to = "Complex", values_drop_na = TRUE) %>%
pivot_longer(cols = dplyr::starts_with("Target"), names_to = NULL,
values_to = "Target", values_drop_na = TRUE) %>%
pivot_longer(cols = dplyr::starts_with("Product"), names_to = NULL,
values_to = "Product", values_drop_na = TRUE)
genes_data_joined <- inner_join(genes_pivoted,
dplyr::select(joined_data, c("HGNC approved symbol",
"log2(FC)", "P value", "Source")),
by = join_by("Symbol" == "HGNC approved symbol"),
relationship = "many-to-many")
# Getting the lists into the right format for the igraph visualization
genes_histone_pivoted <- pivot_longer(genes_data_joined, cols = c("Target", "Product"), names_to = NULL,
values_to = "PTM") %>% distinct()
genes_histone_pivoted$Diff <- case_when(genes_histone_pivoted$`log2(FC)` > 0 ~ "Up",
genes_histone_pivoted$`log2(FC)` < 0 ~ "Down",
.default = "0")
genes_histone_joined <- right_join(genes_histone_pivoted,
dplyr::select(total_histone_int, c("PTM",
"log2(FC)", "P value", "Diff")),
by = c("PTM" = "PTM"), suffix = c("_gene", "_hist"),
relationship = "many-to-many"
)
genes_histone_joined <- relocate(genes_histone_joined, Complex, .after = PTM)
genes_histone_joined[genes_histone_joined == "#"] <- "No ID"
genes_histone_joined$Complex <- genes_histone_joined$Complex %>%  replace_na("No ID")
complexes <- unique(genes_histone_joined$Complex)
n_complexes <- seq(1, length(complexes))
color_opts <- c("#FFFFFF", qualpalr::qualpal(n = (length(complexes) - 1), colorspace = "rainbow")$hex)
complex_df <- data.frame(complexes, n_complexes, color = color_opts)
complex_vertices <- data.frame(vertices = c(unique(genes_histone_joined$Symbol), unique(genes_histone_joined$PTM)))
network_df <- full_join(genes_histone_joined, complex_df, by = join_by("Complex" == "complexes")) %>% relocate(c("Symbol", "PTM"))
complex_vertices <- full_join(complex_vertices, genes_histone_joined, by = join_by("vertices" == "Symbol"), multiple = "all") %>%
dplyr::select(c("vertices", "Complex", "Source", "Diff_gene")) %>% distinct(vertices, .keep_all = TRUE)
complex_graph <- graph_from_data_frame(d = genes_histone_joined, vertices = complex_vertices, directed = FALSE)
complexes <- unique(genes_histone_joined$Complex)
n_complexes <- seq(1, length(complexes))
color_opts <- c("#FFFFFF", qualpalr::qualpal(n = (length(complexes) - 1), colorspace = "rainbow")$hex)
complex_df <- data.frame(complexes, n_complexes, color = color_opts)
complex_vertices <- data.frame(vertices = c(unique(genes_histone_joined$Symbol), unique(genes_histone_joined$PTM)))
network_df <- full_join(genes_histone_joined, complex_df, by = join_by("Complex" == "complexes")) %>% relocate(c("Symbol", "PTM"))
complex_vertices <- full_join(complex_vertices, network_df, by = join_by("vertices" == "Symbol"), multiple = "all") %>%
dplyr::select(c("vertices", "Complex", "Source", "Diff_gene")) %>% distinct(vertices, .keep_all = TRUE)
complex_graph <- graph_from_data_frame(d = network_df, vertices = complex_vertices, directed = FALSE)
View(network_df)
network_df$Symbol <- case_when(network_df$Symbol == NA ~ network_df$PTM,
.default = network_df$Symbol)
complex_vertices <- full_join(complex_vertices, network_df, by = join_by("vertices" == "Symbol"), multiple = "all") %>%
dplyr::select(c("vertices", "Complex", "Source", "Diff_gene")) %>% distinct(vertices, .keep_all = TRUE)
network_df$Symbol <- case_when(is.na(network_df$Symbol) ~ network_df$PTM,
.default = network_df$Symbol)
complex_vertices <- full_join(complex_vertices, network_df, by = join_by("vertices" == "Symbol"), multiple = "all") %>%
dplyr::select(c("vertices", "Complex", "Source", "Diff_gene")) %>% distinct(vertices, .keep_all = TRUE)
complex_vertices <- full_join(complex_vertices, network_df, by = join_by("vertices" == "Symbol"), multiple = "all")
complexes <- unique(genes_histone_joined$Complex)
n_complexes <- seq(1, length(complexes))
color_opts <- c("#FFFFFF", qualpalr::qualpal(n = (length(complexes) - 1), colorspace = "rainbow")$hex)
complex_df <- data.frame(complexes, n_complexes, color = color_opts)
complex_vertices <- data.frame(vertices = c(unique(genes_histone_joined$Symbol), unique(genes_histone_joined$PTM)))
network_df <- full_join(genes_histone_joined, complex_df, by = join_by("Complex" == "complexes")) %>% relocate(c("Symbol", "PTM"))
network_df$Symbol <- case_when(is.na(network_df$Symbol) ~ network_df$PTM,
.default = network_df$Symbol)
complex_vert_attr <- full_join(complex_vertices, network_df, by = join_by("vertices" == "Symbol"), multiple = "all") %>% dplyr::select(c("vertices", "Complex", "Source", "Diff_gene")) %>% distinct(vertices, .keep_all = TRUE)
complex_graph <- graph_from_data_frame(d = network_df, vertices = complex_vert_attr, directed = FALSE)
View(complex_vert_attr)
network_df$Diff <- case_when(network_df$Source == "Histone" ~ network_df$Diff_hist,
.default = network_df$Diff_gene)
complex_vert_attr <- full_join(complex_vertices, network_df, by = join_by("vertices" == "Symbol"), multiple = "all") %>% dplyr::select(c("vertices", "Complex", "Source", "Diff")) %>% distinct(vertices, .keep_all = TRUE)
complex_graph <- graph_from_data_frame(d = network_df, vertices = complex_vert_attr, directed = FALSE)
network_df$Symbol <- case_when(is.na(network_df$Symbol) ~ network_df$PTM,
.default = network_df$Symbol)
network_df$Source <- case_when(is.na(network_df$Symbol) ~ "Histone",
.default = network_df$Source)
network_df$Diff <- case_when(network_df$Source == "Histone" ~ network_df$Diff_hist,
.default = network_df$Diff_gene)
network_df$Source <- case_when(is.na(network_df$Source) ~ "Histone",
.default = network_df$Source)
network_df$Diff <- case_when(network_df$Source == "Histone" ~ network_df$Diff_hist,
.default = network_df$Diff_gene)
complex_vert_attr <- full_join(complex_vertices, network_df, by = join_by("vertices" == "Symbol"), multiple = "all") %>% dplyr::select(c("vertices", "Complex", "Source", "Diff")) %>% distinct(vertices, .keep_all = TRUE)
complex_graph <- graph_from_data_frame(d = network_df, vertices = complex_vert_attr, directed = FALSE)
network_df <- drop_na(network_df, Diff)
complex_vert_attr <- full_join(complex_vertices, network_df, by = join_by("vertices" == "Symbol"), multiple = "all") %>% dplyr::select(c("vertices", "Complex", "Source", "Diff")) %>% distinct(vertices, .keep_all = TRUE)
complex_graph <- graph_from_data_frame(d = network_df, vertices = complex_vert_attr, directed = FALSE)
complex_vert_attr <- left_join(complex_vertices, network_df, by = join_by("vertices" == "Symbol"), multiple = "all") %>% dplyr::select(c("vertices", "Complex", "Source", "Diff")) %>% distinct(vertices, .keep_all = TRUE)
complex_graph <- graph_from_data_frame(d = network_df, vertices = complex_vert_attr, directed = FALSE)
total_histone_int <- filter(total_histone_int, grepl("unmod", PTM))
View(total_histone_int)
total_histone_int <- filter(total_histone_int, !grepl("unmod", PTM))
# filter by that list
total_histone_int <- filter(histone_single_p, grepl(targets, PTM))
total_histone_int$Diff <- case_when(total_histone_int$`log2(FC)` > 0 ~ "Up",
total_histone_int$`log2(FC)` < 0 ~ "Down")
total_histone_int <- filter(total_histone_int, !grepl("unmod", PTM))
# Making sure that no histone data has gotten lost in processing -
# this should match the figure from the earlier section
ggplot(total_histone_int, aes(x = `log2(FC)`, y = -log10(`P value`))) +
geom_point() +
geom_vline(xintercept = c(total_FC_threshold, -total_FC_threshold),
alpha = 0.5, linetype = "dashed") +
geom_hline(yintercept = -log10(total_p_threshold),
alpha = 0.5, linetype = "dashed") +
labs(x = "log2(Fold Change)", y = "-log10(P value)",
title = "Figure 7b: Volcano plot") +
geom_text_repel(aes(label = PTM), show.legend = FALSE, size = rel(3)) +
theme(legend.position = "bottom")
# Pivoting and formatting the gene list
genes_pivoted <- dplyr::select(genes, c("HGNC approved symbol", "Protein complex", "Target entity", "Product")) %>% dplyr::rename("Symbol" = "HGNC approved symbol", "Complex" = "Protein complex", "Target" = "Target entity", "Product" = "Product")
genes_pivoted <- genes_pivoted %>%
separate_wider_delim(cols = c("Complex", "Target", "Product"), delim = ", ",
names_sep = "_", too_few = "align_start")
genes_pivoted <- genes_pivoted %>%
pivot_longer(cols = dplyr::starts_with("Complex"), names_to = NULL,
values_to = "Complex", values_drop_na = TRUE) %>%
pivot_longer(cols = dplyr::starts_with("Target"), names_to = NULL,
values_to = "Target", values_drop_na = TRUE) %>%
pivot_longer(cols = dplyr::starts_with("Product"), names_to = NULL,
values_to = "Product", values_drop_na = TRUE)
genes_data_joined <- inner_join(genes_pivoted,
dplyr::select(joined_data, c("HGNC approved symbol",
"log2(FC)", "P value", "Source")),
by = join_by("Symbol" == "HGNC approved symbol"),
relationship = "many-to-many")
# Getting the lists into the right format for the igraph visualization
genes_histone_pivoted <- pivot_longer(genes_data_joined, cols = c("Target", "Product"), names_to = NULL,
values_to = "PTM") %>% distinct()
genes_histone_pivoted$Diff <- case_when(genes_histone_pivoted$`log2(FC)` > 0 ~ "Up",
genes_histone_pivoted$`log2(FC)` < 0 ~ "Down",
.default = "0")
genes_histone_joined <- right_join(genes_histone_pivoted,
dplyr::select(total_histone_int, c("PTM",
"log2(FC)", "P value", "Diff")),
by = c("PTM" = "PTM"), suffix = c("_gene", "_hist"),
relationship = "many-to-many"
)
genes_histone_joined <- relocate(genes_histone_joined, Complex, .after = PTM)
genes_histone_joined[genes_histone_joined == "#"] <- "No ID"
genes_histone_joined$Complex <- genes_histone_joined$Complex %>%  replace_na("No ID")
complexes <- unique(genes_histone_joined$Complex)
n_complexes <- seq(1, length(complexes))
color_opts <- c("#FFFFFF", qualpalr::qualpal(n = (length(complexes) - 1), colorspace = "rainbow")$hex)
complex_df <- data.frame(complexes, n_complexes, color = color_opts)
complex_vertices <- data.frame(vertices = c(unique(genes_histone_joined$Symbol), unique(genes_histone_joined$PTM)))
network_df <- full_join(genes_histone_joined, complex_df, by = join_by("Complex" == "complexes")) %>% relocate(c("Symbol", "PTM"))
network_df$Symbol <- case_when(is.na(network_df$Symbol) ~ network_df$PTM,
.default = network_df$Symbol)
network_df$Source <- case_when(is.na(network_df$Source) ~ "Histone",
.default = network_df$Source)
network_df$Diff <- case_when(network_df$Source == "Histone" ~ network_df$Diff_hist,
.default = network_df$Diff_gene)
network_df <- drop_na(network_df, Diff)
complex_vert_attr <- left_join(complex_vertices, network_df, by = join_by("vertices" == "Symbol"), multiple = "all") %>% dplyr::select(c("vertices", "Complex", "Source", "Diff")) %>% distinct(vertices, .keep_all = TRUE)
complex_graph <- graph_from_data_frame(d = network_df, vertices = complex_vert_attr, directed = FALSE)
complex_vert_attr <- left_join(complex_vertices, network_df, by = join_by("vertices" == "Symbol"), multiple = "all") %>% dplyr::select(c("vertices", "Complex", "Source", "Diff")) %>% distinct(vertices, .keep_all = TRUE) %>% drop_na()
complex_graph <- graph_from_data_frame(d = network_df, vertices = complex_vert_attr, directed = FALSE)
setdiff(network_df$Symbol, complex_vert_attr)
setdiff(network_df$Symbol, complex_vert_attr$vertices)
setdiff(network_df$PTM, complex_vert_attr$vertices)
complex_vert_attr <- left_join(complex_vertices, network_df, by = join_by("vertices" == "Symbol"), multiple = "all") %>% dplyr::select(c("vertices", "Complex", "Source", "Diff")) %>% distinct(vertices, .keep_all = TRUE)
complex_vert_attr <- left_join(complex_vertices, network_df, by = join_by("vertices" == "Symbol"), multiple = "all") %>% dplyr::select(c("vertices", "Complex", "Source", "Diff")) %>% distinct(vertices, .keep_all = TRUE) %>% drop_na(vertices)
complexes <- unique(genes_histone_joined$Complex)
n_complexes <- seq(1, length(complexes))
color_opts <- c("#FFFFFF", qualpalr::qualpal(n = (length(complexes) - 1), colorspace = "rainbow")$hex)
complex_df <- data.frame(complexes, n_complexes, color = color_opts)
complex_vertices <- data.frame(vertices = c(unique(genes_histone_joined$Symbol), unique(genes_histone_joined$PTM)))
network_df <- full_join(genes_histone_joined, complex_df, by = join_by("Complex" == "complexes")) %>% relocate(c("Symbol", "PTM"))
network_df$Symbol <- case_when(is.na(network_df$Symbol) ~ network_df$PTM,
.default = network_df$Symbol)
network_df$Source <- case_when(is.na(network_df$Source) ~ "Histone",
.default = network_df$Source)
network_df$Diff <- case_when(network_df$Source == "Histone" ~ network_df$Diff_hist,
.default = network_df$Diff_gene)
#network_df <- drop_na(network_df, Diff)
complex_vert_attr <- left_join(complex_vertices, network_df, by = join_by("vertices" == "Symbol"), multiple = "all") %>% dplyr::select(c("vertices", "Complex", "Source", "Diff")) %>% distinct(vertices, .keep_all = TRUE) %>% drop_na(vertices)
complex_graph <- graph_from_data_frame(d = network_df, vertices = complex_vert_attr, directed = FALSE)
with_id <- filter(genes_histone_joined, Complex != "No ID") %>% drop_na("P value_gene")
sig_network <- distinct(group_by(filter(genes_histone_joined, Complex != "No ID"), Complex), Symbol, .keep_all = TRUE)
sig_network["weight"] <- 1
sig_network$Complex <- factor(sig_network$Complex, levels = unique(as.character(sig_network$Complex)))
ggplot(sig_network, aes(x = Complex, y = weight)) +
geom_col(aes(fill = Complex), position = "stack", width = 0.7) +
geom_label(aes(label = Symbol, angle = 30), size = rel(2),
position = position_stack(vjust = 0.5)) +
guides(fill = "none") +
theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
axis.title.x = element_blank(), axis.title.y = element_blank(),
plot.margin = margin(t = 10, r = 10, b = 10, l = 10)) +
labs(title = "Figure 7c: Network components")
leg <- ggpubr::get_legend(ggplot(sig_network, aes(x = Complex, y = weight)) +
geom_col(aes(fill = Complex), position = "stack") +
scale_fill_manual(values = unique(sig_network$color)) +
guides(fill = guide_legend(ncol = 4)))
ggplot(sig_network, aes(x = Complex, y = Symbol, fill = PTM)) +
geom_bin_2d() +
theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
axis.title.x = element_blank(), axis.title.y = element_blank()) +
paletteer::scale_fill_paletteer_d("ggsci::default_igv") +
scale_y_discrete(limits = rev) +
labs(title = "Figure 7d: Network bins")
sig_network$Shapes<- case_when(sig_network$Diff_gene == "Up" ~ "triangle",
sig_network$Diff_gene == "Down" ~ "triangleDown")
sig_network_py <- r_to_py(sig_network)
reticulate::repl_python()
htmltools::renderDocument(htmltools::htmlTemplate("networkx-pyvis.html"))
with_id <- filter(network_df, Complex != "No ID") %>% drop_na("P value_gene")
sig_network <- distinct(group_by(filter(network_df, Complex != "No ID"), Complex), Symbol, .keep_all = TRUE)
sig_network["weight"] <- 1
sig_network$Complex <- factor(sig_network$Complex, levels = unique(as.character(sig_network$Complex)))
ggplot(sig_network, aes(x = Complex, y = weight)) +
geom_col(aes(fill = Complex), position = "stack", width = 0.7) +
geom_label(aes(label = Symbol, angle = 30), size = rel(2),
position = position_stack(vjust = 0.5)) +
guides(fill = "none") +
theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
axis.title.x = element_blank(), axis.title.y = element_blank(),
plot.margin = margin(t = 10, r = 10, b = 10, l = 10)) +
labs(title = "Figure 7c: Network components")
ggplot(network_df, aes(x = Complex, y = Symbol, fill = PTM)) +
geom_bin_2d() +
theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
axis.title.x = element_blank(), axis.title.y = element_blank()) +
paletteer::scale_fill_paletteer_d("ggsci::default_igv") +
scale_y_discrete(limits = rev) +
labs(title = "Figure 7d: Network bins")
ggplot(sig_network, aes(x = Complex, y = Symbol, fill = PTM)) +
geom_bin_2d() +
theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
axis.title.x = element_blank(), axis.title.y = element_blank()) +
paletteer::scale_fill_paletteer_d("ggsci::default_igv") +
scale_y_discrete(limits = rev) +
labs(title = "Figure 7d: Network bins")
View(sig_network)
View(with_id)
with_id <- filter(complex_vert_attr, Complex != "No ID")
sig_network <- distinct(group_by(with_id, Complex), Symbol, .keep_all = TRUE)
with_id <- filter(complex_vert_attr, Complex != "No ID")
sig_network <- distinct(group_by(with_id, Complex), vertices, .keep_all = TRUE)
with_id <- filter(complex_vert_attr, Complex != "No ID")
sig_network <- distinct(group_by(with_id, Complex), vertices, .keep_all = TRUE)
sig_network["weight"] <- 1
sig_network$Complex <- factor(sig_network$Complex, levels = unique(as.character(sig_network$Complex)))
ggplot(sig_network, aes(x = Complex, y = weight)) +
geom_col(aes(fill = Complex), position = "stack", width = 0.7) +
geom_label(aes(label = Symbol, angle = 30), size = rel(2),
position = position_stack(vjust = 0.5)) +
guides(fill = "none") +
theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
axis.title.x = element_blank(), axis.title.y = element_blank(),
plot.margin = margin(t = 10, r = 10, b = 10, l = 10)) +
labs(title = "Figure 7c: Network components")
ggplot(sig_network, aes(x = Complex, y = weight)) +
geom_col(aes(fill = Complex), position = "stack", width = 0.7) +
geom_label(aes(label = vertices, angle = 30), size = rel(2),
position = position_stack(vjust = 0.5)) +
guides(fill = "none") +
theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
axis.title.x = element_blank(), axis.title.y = element_blank(),
plot.margin = margin(t = 10, r = 10, b = 10, l = 10)) +
labs(title = "Figure 7c: Network components")
ggplot(sig_network, aes(x = Complex, y = Symbol, fill = PTM)) +
geom_bin_2d() +
theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
axis.title.x = element_blank(), axis.title.y = element_blank()) +
paletteer::scale_fill_paletteer_d("ggsci::default_igv") +
scale_y_discrete(limits = rev) +
labs(title = "Figure 7d: Network bins")
ggplot(sig_network, aes(x = Complex, y = vertices, fill = PTM)) +
geom_bin_2d() +
theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
axis.title.x = element_blank(), axis.title.y = element_blank()) +
paletteer::scale_fill_paletteer_d("ggsci::default_igv") +
scale_y_discrete(limits = rev) +
labs(title = "Figure 7d: Network bins")
ggplot(complex_df, aes(x = Complex, y = Symbol, fill = PTM)) +
geom_bin_2d() +
theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
axis.title.x = element_blank(), axis.title.y = element_blank()) +
paletteer::scale_fill_paletteer_d("ggsci::default_igv") +
scale_y_discrete(limits = rev) +
labs(title = "Figure 7d: Network bins")
ggplot(network_df, aes(x = Complex, y = Symbol, fill = PTM)) +
geom_bin_2d() +
theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
axis.title.x = element_blank(), axis.title.y = element_blank()) +
paletteer::scale_fill_paletteer_d("ggsci::default_igv") +
scale_y_discrete(limits = rev) +
labs(title = "Figure 7d: Network bins")
with_id <- filter(network_df, Complex != "No ID")
sig_network <- distinct(group_by(with_id, Complex), vertices, .keep_all = TRUE)
sig_network <- distinct(group_by(with_id, Complex), Symbol, .keep_all = TRUE)
with_id <- filter(network_df, Complex != "No ID")
sig_network <- distinct(group_by(with_id, Complex), Symbol, .keep_all = TRUE)
sig_network["weight"] <- 1
sig_network$Complex <- factor(sig_network$Complex, levels = unique(as.character(sig_network$Complex)))
ggplot(sig_network, aes(x = Complex, y = weight)) +
geom_col(aes(fill = Complex), position = "stack", width = 0.7) +
geom_label(aes(label = Symbol, angle = 30), size = rel(2),
position = position_stack(vjust = 0.5)) +
guides(fill = "none") +
theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
axis.title.x = element_blank(), axis.title.y = element_blank(),
plot.margin = margin(t = 10, r = 10, b = 10, l = 10)) +
labs(title = "Figure 7c: Network components")
ggplot(network_df, aes(x = Complex, y = Symbol, fill = PTM)) +
geom_bin_2d() +
theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
axis.title.x = element_blank(), axis.title.y = element_blank()) +
paletteer::scale_fill_paletteer_d("ggsci::default_igv") +
scale_y_discrete(limits = rev) +
labs(title = "Figure 7d: Network bins")
ggplot(sig_network, aes(x = Complex, y = Symbol, fill = PTM)) +
geom_bin_2d() +
theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
axis.title.x = element_blank(), axis.title.y = element_blank()) +
paletteer::scale_fill_paletteer_d("ggsci::default_igv") +
scale_y_discrete(limits = rev) +
labs(title = "Figure 7d: Network bins")
complex_vert_attr$Shapes<- case_when(complex_vert_attr$Diff == "Up" ~ "triangle",
complex_vert_attr$Diff == "Down" ~ "triangleDown")
sig_network_py <- r_to_py(complex_vert_attr)
reticulate::repl_python()
network_df$Shapes<- case_when(network_df$Diff == "Up" ~ "triangle",
network_df$Diff == "Down" ~ "triangleDown")
sig_network_py <- r_to_py(network_df)
reticulate::repl_python()
htmltools::renderDocument(htmltools::htmlTemplate("networkx-pyvis.html"))
reticulate::repl_python()
